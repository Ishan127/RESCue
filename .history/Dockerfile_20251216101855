FROM rocm/pytorch:rocm6.2_ubuntu22.04

WORKDIR /app

RUN apt-get update && apt-get install -y \
    git \
    wget \
    libgl1 \
    && rm -rf /var/lib/apt/lists/*

COPY . /app

RUN pip install --upgrade pip
RUN pip install -r requirements.txt

RUN pip install vllm==0.6.3.post1 --extra-index-url https://wheels.vllm.ai/rocm61 || echo "Warning: vLLM install failed, assuming pre-installed or custom mount."

RUN chmod +x scripts/*.sh

CMD ["bash", "scripts/run_workflow.sh"]
